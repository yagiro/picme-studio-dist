(function(j,C){typeof exports=="object"&&typeof module<"u"?C(require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["react","react-dom"],C):(j=typeof globalThis<"u"?globalThis:j||self,C(j.React,j.ReactDOM))})(this,function(j,C){"use strict";var D={exports:{}},F={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z;function pe(){if(Z)return F;Z=1;var e=j,t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,u=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b={key:!0,ref:!0,__self:!0,__source:!0};function v(m,f,o){var h,_={},x=null,I=null;o!==void 0&&(x=""+o),f.key!==void 0&&(x=""+f.key),f.ref!==void 0&&(I=f.ref);for(h in f)r.call(f,h)&&!b.hasOwnProperty(h)&&(_[h]=f[h]);if(m&&m.defaultProps)for(h in f=m.defaultProps,f)_[h]===void 0&&(_[h]=f[h]);return{$$typeof:t,type:m,key:x,ref:I,props:_,_owner:u.current}}return F.Fragment=n,F.jsx=v,F.jsxs=v,F}var q;function ge(){return q||(q=1,D.exports=pe()),D.exports}var p=ge();let be=0;function S(e,t){const n=`atom${++be}`,r={toString(){return n}};return typeof e=="function"?r.read=e:(r.init=e,r.read=ve,r.write=ye),t&&(r.write=t),r}function ve(e){return e(this)}function ye(e,t,n){return t(this,typeof n=="function"?n(e(this)):n)}const $=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,ee=e=>"init"in e,ne=e=>!!e.write,M=new WeakMap,L=e=>{var t;return T(e)&&!((t=M.get(e))!=null&&t[1])},we=(e,t)=>{const n=M.get(e);n&&(n[1]=!0,n[0].forEach(r=>r(t)))},_e=e=>{if(M.has(e))return;const t=[new Set,!1];M.set(e,t);const n=()=>{t[1]=!0};e.then(n,n),e.onCancel=r=>{t[0].add(r)}},T=e=>typeof(e==null?void 0:e.then)=="function",te=e=>"v"in e||"e"in e,O=e=>{if("e"in e)throw e.e;return e.v},se=(e,t,n)=>{n.p.has(e)||(n.p.add(e),t.then(()=>{n.p.delete(e)},()=>{n.p.delete(e)}))},xe=(e,t,n,r)=>{var u;t.d.set(n,r.n),L(t.v)&&se(e,t.v,r),(u=r.m)==null||u.t.add(e)},je=Symbol.for("JOTAI.EXPERIMENTAL.FLUSHSTOREHOOK"),re=(...e)=>{const[t,n,r,u,b,v]=e,m=c=>{let s=t(c);return s||(s={d:new Map,p:new Set,n:0},n(c,s),b==null||b(c,U)),s},f=new WeakMap,o=new Map,h=new Set,_=new Set,x=()=>{var c;const s=[],i=l=>{try{l()}catch(d){s.push(d)}};do{(c=U[je])==null||c.call(U);const l=new Set,d=l.add.bind(l);o.forEach(a=>{var g;return(g=a.m)==null?void 0:g.l.forEach(d)}),o.clear(),h.forEach(d),h.clear(),_.forEach(d),_.clear(),l.forEach(i),o.size&&P()}while(o.size||h.size||_.size);if(s.length)throw s[0]},I=(c,s,i)=>{const l="v"in s,d=s.v,a=L(s.v)?s.v:null;if(T(i)){_e(i);for(const g of s.d.keys())se(c,i,m(g));s.v=i}else s.v=i;delete s.e,(!l||!Object.is(d,s.v))&&(++s.n,a&&we(a,i))},R=c=>{var s;const i=m(c);if(te(i)&&(i.m&&f.get(c)!==i.n||Array.from(i.d).every(([y,E])=>R(y).n===E)))return i;i.d.clear();let l=!0;const d=()=>{i.m&&(X(c,i),P(),x())},a=y=>{if($(c,y)){const Q=m(y);if(!te(Q))if(ee(y))I(y,Q,y.init);else throw new Error("no atom init");return O(Q)}const E=R(y);try{return O(E)}finally{xe(c,i,y,E),l||d()}};let g,w;const A={get signal(){return g||(g=new AbortController),g.signal},get setSelf(){return!w&&ne(c)&&(w=(...y)=>{if(!l)return he(c,...y)}),w}};try{const y=r(c,a,A);return I(c,i,y),T(y)&&((s=y.onCancel)==null||s.call(y,()=>g==null?void 0:g.abort()),y.then(d,d)),i}catch(y){return delete i.v,i.e=y,++i.n,i}finally{l=!1}},de=c=>O(R(c)),fe=c=>{var s;const i=new Map;for(const l of((s=c.m)==null?void 0:s.t)||[]){const d=m(l);d.m&&i.set(l,d)}for(const l of c.p)i.set(l,m(l));return i},me=c=>{const s=[c];for(;s.length;){const i=s.pop();for(const[l,d]of fe(i))f.has(l)||(f.set(l,d.n),s.push(d))}},P=()=>{var c;const s=[],i=new WeakSet,l=new WeakSet,d=Array.from(o);for(;d.length;){const[a,g]=d[d.length-1];if(l.has(a)){d.pop();continue}if(i.has(a)){f.get(a)===g.n?s.push([a,g,g.n]):(f.delete(a),o.set(a,g)),l.add(a),d.pop();continue}i.add(a);for(const[w,A]of fe(g))i.has(w)||d.push([w,A])}for(let a=s.length-1;a>=0;--a){const[g,w,A]=s[a];let y=!1;for(const E of w.d.keys())if(E!==g&&o.has(E)){y=!0;break}y&&(R(g),X(g,w),A!==w.n&&(o.set(g,w),(c=w.u)==null||c.call(w))),f.delete(g)}},G=(c,...s)=>{let i=!0;const l=a=>O(R(a)),d=(a,...g)=>{var w;const A=m(a);try{if($(c,a)){if(!ee(a))throw new Error("atom not writable");const y=A.n,E=g[0];I(a,A,E),X(a,A),y!==A.n&&(o.set(a,A),(w=A.u)==null||w.call(A),me(A));return}else return G(a,...g)}finally{i||(P(),x())}};try{return u(c,l,d,...s)}finally{i=!1}},he=(c,...s)=>{try{return G(c,...s)}finally{P(),x()}},X=(c,s)=>{var i;if(s.m&&!L(s.v)){for(const[l,d]of s.d)if(!s.m.d.has(l)){const a=m(l);Y(l,a).t.add(c),s.m.d.add(l),d!==a.n&&(o.set(l,a),(i=a.u)==null||i.call(a),me(a))}for(const l of s.m.d||[])if(!s.d.has(l)){s.m.d.delete(l);const d=K(l,m(l));d==null||d.t.delete(c)}}},Y=(c,s)=>{var i;if(!s.m){R(c);for(const l of s.d.keys())Y(l,m(l)).t.add(c);if(s.m={l:new Set,d:new Set(s.d.keys()),t:new Set},(i=s.h)==null||i.call(s),ne(c)){const l=s.m,d=()=>{let a=!0;const g=(...w)=>{try{return G(c,...w)}finally{a||(P(),x())}};try{const w=v(c,g);w&&(l.u=()=>{a=!0;try{w()}finally{a=!1}})}finally{a=!1}};_.add(d)}}return s.m},K=(c,s)=>{var i;if(s.m&&!s.m.l.size&&!Array.from(s.m.t).some(l=>{var d;return(d=m(l).m)==null?void 0:d.d.has(c)})){const l=s.m.u;l&&h.add(l),delete s.m,(i=s.h)==null||i.call(s);for(const d of s.d.keys()){const a=K(d,m(d));a==null||a.t.delete(c)}return}return s.m},U={get:de,set:he,sub:(c,s)=>{const i=m(c),d=Y(c,i).l;return d.add(s),x(),()=>{d.delete(s),K(c,i),x()}},unstable_derive:c=>re(...c(...e))};return U},Ie=()=>{const e=new WeakMap;return re(n=>e.get(n),(n,r)=>e.set(n,r).get(n),(n,...r)=>n.read(...r),(n,...r)=>n.write(...r),(n,...r)=>{var u;return(u=n.unstable_onInit)==null?void 0:u.call(n,...r)},(n,...r)=>{var u;return(u=n.onMount)==null?void 0:u.call(n,...r)})};let W;const Ae=()=>(W||(W=Ie()),W),Re=j.createContext(void 0),oe=e=>j.useContext(Re)||Ae(),ce=e=>typeof(e==null?void 0:e.then)=="function",Ee=e=>{e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t})},Ce=j.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Ee(e),e)}),J=new WeakMap,ke=e=>{let t=J.get(e);return t||(t=new Promise((n,r)=>{let u=e;const b=f=>o=>{u===f&&n(o)},v=f=>o=>{u===f&&r(o)},m=f=>{"onCancel"in f&&typeof f.onCancel=="function"&&f.onCancel(o=>{ce(o)?(J.set(o,t),u=o,o.then(b(o),v(o)),m(o)):n(o)})};e.then(b(e),v(e)),m(e)}),J.set(e,t)),t};function z(e,t){const n=oe(),[[r,u,b],v]=j.useReducer(o=>{const h=n.get(e);return Object.is(o[0],h)&&o[1]===n&&o[2]===e?o:[h,n,e]},void 0,()=>[n.get(e),n,e]);let m=r;if((u!==n||b!==e)&&(v(),m=n.get(e)),j.useEffect(()=>{const o=n.sub(e,()=>{v()});return v(),o},[n,e,void 0]),j.useDebugValue(m),ce(m)){const o=ke(m);return Ce(o)}return m}function ie(e,t){const n=oe();return j.useCallback((...u)=>n.set(e,...u),[n,e])}function B(e,t){return[z(e),ie(e)]}const Fe=Symbol(""),Se=e=>typeof(e==null?void 0:e.then)=="function";function Pe(e=()=>{try{return window.localStorage}catch{return}},t){var n;let r,u;const b={getItem:(f,o)=>{var h,_;const x=R=>{if(R=R||"",r!==R){try{u=JSON.parse(R,t==null?void 0:t.reviver)}catch{return o}r=R}return u},I=(_=(h=e())==null?void 0:h.getItem(f))!=null?_:null;return Se(I)?I.then(x):x(I)},setItem:(f,o)=>{var h;return(h=e())==null?void 0:h.setItem(f,JSON.stringify(o,void 0))},removeItem:f=>{var o;return(o=e())==null?void 0:o.removeItem(f)}},v=f=>(o,h,_)=>f(o,x=>{let I;try{I=JSON.parse(x||"")}catch{I=_}h(I)});let m;try{m=(n=e())==null?void 0:n.subscribe}catch{}return!m&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(m=(f,o)=>{if(!(e()instanceof window.Storage))return()=>{};const h=_=>{_.storageArea===e()&&_.key===f&&o(_.newValue)};return window.addEventListener("storage",h),()=>{window.removeEventListener("storage",h)}}),m&&(b.subscribe=v(m)),b}const Me=Pe();function Oe(e,t,n=Me,r){const u=S(t);return u.onMount=v=>{v(n.getItem(e,t));let m;return n.subscribe&&(m=n.subscribe(e,v,t)),m},S(v=>v(u),(v,m,f)=>{const o=typeof f=="function"?f(v(u)):f;return o===Fe?(m(u,t),n.removeItem(e)):o instanceof Promise?o.then(h=>(m(u,h),n.setItem(e,h))):(m(u,o),n.setItem(e,o))})}const k={gender:Oe("gender",void 0),faceImageSrc:S(""),faceImageFile:S(),resImageUrl:S("")},Ne=["png","bmp","gif","jpg","jpeg","pjpeg","svg","tiff","webp"];function Ue(e){var n;return(n=e.target.files)==null?void 0:n[0]}function De(e){return URL.createObjectURL(e)}const Le=Ne.map(e=>`.${e}`).join(", ");function Te(e){return p.jsx("input",{type:"file",accept:Le,onChange:e.onChange})}const We=e=>p.jsx("img",{...e});function le(e){return p.jsx("div",{children:p.jsx(We,{...e})})}function Je(){const[e,t]=B(k.faceImageSrc),n=ie(k.faceImageFile),r=u=>{const b=Ue(u);if(!b){alert("file error");return}const v=De(b);n(b),t(v)};return p.jsxs("div",{className:"flex flex-col gap-2",children:[p.jsx("div",{children:"upload an image of your face"}),p.jsx(Te,{onChange:r}),e&&p.jsx(ze,{src:e})]})}function ze(e){return p.jsx(le,{className:"max-w-md max-h-56",src:e.src,alt:"Image of your face"})}function H(e){return e.join(" ")}function Be(e){const t=Object.entries(e).map(([n,r])=>r?n:null).filter(n=>n!==null);return H(t)}function He(e){return e==null?null:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"?e.toString():Array.isArray(e)?H(e):typeof e=="object"?Be(e):null}function N(...e){const t=e.map(He).filter(n=>n!==null);return H(t)}const ue={regular:"bg-gray-200 text-gray-900",checked:"bg-gray-700 text-white"};function Ve(e){const{option:t,checked:n,onSelect:r}=e,u=r,b=N("flex flex-row gap-1 rounded p-2","cursor-pointer",n?ue.checked:ue.regular);return p.jsxs("div",{className:b,onClick:u,children:[p.jsx("input",{className:"hidden",type:"radio",value:t.value,checked:n,readOnly:!0}),p.jsx("div",{children:t.label})]})}function Ge(e){const{value:t,options:n,onChange:r}=e;return p.jsx("div",{className:"flex flex-row",children:n.map(u=>p.jsx(Ve,{option:u,checked:u.value===t,onSelect:()=>r(u.value)},u.value))})}function Xe(e){const t=new FormData;return Object.entries(e).forEach(([n,r])=>{t.append(n,r)}),t}var V=(e=>(e.Male="m",e.Female="f",e))(V||{});const Ye=[{value:V.Male,label:"male"},{value:V.Female,label:"female"}];function Ke(){const[e,t]=B(k.gender);return p.jsx(Ge,{options:Ye,value:e,onChange:n=>t(n)})}function Qe(e){return e.imageUrl?p.jsx("div",{children:p.jsx(le,{src:e.imageUrl,className:"max-w-md max-h-56"})}):null}const Ze="text-white p-3 rounded",qe="bg-pink-400",$e="bg-pink-200",en=e=>{const t=N(Ze,e.className,e.disabled?$e:qe);return p.jsx("button",{...e,className:t})},nn={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BFF_API_URL:"http://0.0.0.0:5555"},tn=(e,t)=>nn[e];function sn(e){return async function(n,r){const u={path:n,reqInit:r};console.log("sending request",u);const b=await fetch(`${e}${n}`,r);u.response=b,b.ok||console.error("response is not ok",{path:n,reqInit:r,response:b}),console.log("got response",{path:n,reqInit:r,response:b});const v=await b.json();return console.log("got response body",{path:n,reqInit:r,body:v}),v}}const rn=tn("VITE_BFF_API_URL"),on=sn(rn),cn={async genAiImage(e){const t=Xe(e);return await on("/swap_face",{method:"post",body:t})}},ln={contr:N("flex flex-col gap-4")};function un(){const e=z(k.gender),t=z(k.faceImageFile),[n,r]=B(k.resImageUrl),u=t&&e,b=async()=>{const v=await cn.genAiImage({image:t,gender:e});r(v.imageUrl)};return p.jsxs("div",{className:ln.contr,children:[p.jsx(Ke,{}),p.jsx(Je,{}),p.jsx(en,{onClick:()=>void b(),disabled:!u,children:"generate"}),p.jsx(Qe,{imageUrl:n})]})}const ae={app:N("flex flex-col gap-7","justify-center items-center","bg-amber-50"),title:"text-4xl text-zinc-900"};function an(){return p.jsxs("div",{className:ae.app,children:[p.jsx("div",{className:ae.title,children:"Picme Studio"}),p.jsx(un,{})]})}class dn extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"open"}),n=document.createElement("div");t.append(n);const r=document.createElement("link");r.rel="stylesheet",r.href="http://localhost:3001/picme-studio.css",t.appendChild(r),C.render(p.jsx(j.StrictMode,{children:p.jsx(an,{})}),n)}disconnectedCallback(){var t;(t=this.shadowRoot)!=null&&t.firstChild&&C.unmountComponentAtNode(this.shadowRoot.firstChild)}}window.customElements.define("picme-studio",dn)});
